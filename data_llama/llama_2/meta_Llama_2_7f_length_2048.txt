Initializing Torch distributed.
************ Finish sequence pralell group Initialization. ***********
trainable params 6738415616
trainable params 6738415616
trainable params 6738415616
torch distributed is already initialized, skipping initialization ...
trainable params 6738415616
Initializing global memoery buffer.
Initializing global memoery buffer for backward.
Cumulated time list [19.99375820159912]Cumulated time list [19.99318504333496]

Cumulated time list [19.993892669677734]
Cumulated time list [19.996052503585815]
Cumulated time list [19.99318504333496, 20.39219641685486]Cumulated time list [19.99375820159912, 20.392221927642822]

Cumulated time list [19.993892669677734, 20.392162322998047]
Cumulated time list [19.996052503585815, 20.389949798583984]
Cumulated time list [19.996052503585815, 20.389949798583984, 20.380038499832153]
Cumulated time list [19.99375820159912, 20.392221927642822, 20.38056445121765]
Cumulated time list [19.99318504333496, 20.39219641685486, 20.380731344223022]
Cumulated time list [19.993892669677734, 20.392162322998047, 20.380473613739014]
Cumulated time list [19.996052503585815, 20.389949798583984, 20.380038499832153, 20.399479389190674]
Cumulated time list [19.993892669677734, 20.392162322998047, 20.380473613739014, 20.39935803413391]
Cumulated time list [19.99375820159912, 20.392221927642822, 20.38056445121765, 20.39970564842224]
Cumulated time list [19.99318504333496, 20.39219641685486, 20.380731344223022, 20.402605772018433]
Cumulated time list [19.99318504333496, 20.39219641685486, 20.380731344223022, 20.402605772018433, 20.408705711364746]
Cumulated time list [19.996052503585815, 20.389949798583984, 20.380038499832153, 20.399479389190674, 20.412213802337646]Cumulated time list [19.993892669677734, 20.392162322998047, 20.380473613739014, 20.39935803413391, 20.411770582199097]

Cumulated time list [19.99375820159912, 20.392221927642822, 20.38056445121765, 20.39970564842224, 20.41199278831482]
Cumulated time list [19.996052503585815, 20.389949798583984, 20.380038499832153, 20.399479389190674, 20.412213802337646, 20.38718843460083]
Cumulated time list [19.993892669677734, 20.392162322998047, 20.380473613739014, 20.39935803413391, 20.411770582199097, 20.387240886688232]
Cumulated time list [19.99318504333496, 20.39219641685486, 20.380731344223022, 20.402605772018433, 20.408705711364746, 20.387561798095703]
Cumulated time list [19.99375820159912, 20.392221927642822, 20.38056445121765, 20.39970564842224, 20.41199278831482, 20.39012622833252]
Cumulated time list [19.99375820159912, 20.392221927642822, 20.38056445121765, 20.39970564842224, 20.41199278831482, 20.39012622833252, 20.358910083770752]
Cumulated time list [19.996052503585815, 20.389949798583984, 20.380038499832153, 20.399479389190674, 20.412213802337646, 20.38718843460083, 20.361967086791992]
Cumulated time list [19.993892669677734, 20.392162322998047, 20.380473613739014, 20.39935803413391, 20.411770582199097, 20.387240886688232, 20.361942529678345]
Cumulated time list [19.99318504333496, 20.39219641685486, 20.380731344223022, 20.402605772018433, 20.408705711364746, 20.387561798095703, 20.362059593200684]
Cumulated time list [19.993892669677734, 20.392162322998047, 20.380473613739014, 20.39935803413391, 20.411770582199097, 20.387240886688232, 20.361942529678345, 20.407979488372803]Cumulated time list [19.99318504333496, 20.39219641685486, 20.380731344223022, 20.402605772018433, 20.408705711364746, 20.387561798095703, 20.362059593200684, 20.40758490562439]

Cumulated time list [19.99375820159912, 20.392221927642822, 20.38056445121765, 20.39970564842224, 20.41199278831482, 20.39012622833252, 20.358910083770752, 20.408038854599]
Cumulated time list [19.996052503585815, 20.389949798583984, 20.380038499832153, 20.399479389190674, 20.412213802337646, 20.38718843460083, 20.361967086791992, 20.408211708068848]
Cumulated time list [19.993892669677734, 20.392162322998047, 20.380473613739014, 20.39935803413391, 20.411770582199097, 20.387240886688232, 20.361942529678345, 20.407979488372803, 20.366808891296387]
Cumulated time list [19.99318504333496, 20.39219641685486, 20.380731344223022, 20.402605772018433, 20.408705711364746, 20.387561798095703, 20.362059593200684, 20.40758490562439, 20.36692452430725]
Cumulated time list [19.99375820159912, 20.392221927642822, 20.38056445121765, 20.39970564842224, 20.41199278831482, 20.39012622833252, 20.358910083770752, 20.408038854599, 20.366976976394653]
Cumulated time list [19.996052503585815, 20.389949798583984, 20.380038499832153, 20.399479389190674, 20.412213802337646, 20.38718843460083, 20.361967086791992, 20.408211708068848, 20.368673086166382]
Per GPU shape: torch.Size([1, 2048]), 20344.863812128704 ms, 124.33018287246269 ms
Per GPU shape: torch.Size([1, 2048]), 20344.69946225484 ms, 125.18085668712328 ms
Per GPU shape: torch.Size([1, 2048]), 20344.617234336005 ms, 125.23471743397869 ms
Per GPU shape: torch.Size([1, 2048]), 20344.625446531507 ms, 125.02633003273777 ms
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
autograd::engine::evaluate_function: CheckpointFunct...         0.00%      11.914ms        41.23%      147.926s     462.268ms       0.000us         0.00%      200.641s     627.003ms           0 b           0 b      29.42 Gb     -14.77 Gb           320  
        CheckpointFunctionEndWithFlashAttentionBackward         0.28%        1.018s        41.22%      147.914s     462.231ms       15.959s         2.83%      200.641s     627.003ms           0 b     -10.00 Kb      44.18 Gb     -81.16 Gb           320  
                                     record_param_comms         0.84%        3.001s         0.92%        3.319s     258.466us      183.546s        32.55%      190.927s      14.870ms           0 b           0 b           0 b           0 b         12840  
                       FullyShardedDataParallel.forward         0.23%     828.204ms        30.48%      109.366s      84.780ms       0.000us         0.00%      180.849s     140.193ms       1.60 Mb           0 b     151.24 Gb    -347.10 Gb          1290  
                                 c10d::_allgather_base_         0.01%      36.254ms         0.85%        3.044s       1.577ms       0.000us         0.00%      139.730s      72.399ms           0 b           0 b           0 b           0 b          1930  
ncclDevKernel_AllGather_RING_LL(ncclDevComm*, unsign...         0.00%       0.000us         0.00%       0.000us       0.000us      136.534s        24.21%      136.534s      70.743ms           0 b           0 b           0 b           0 b          1930  
                                  nccl:_all_gather_base         0.00%       0.000us         0.00%       0.000us       0.000us      136.534s        24.21%      136.534s      70.743ms           0 b           0 b           0 b           0 b          1930  
                  FullyShardedDataParallel._pre_forward         0.31%        1.099s        13.39%       48.049s      37.247ms       0.000us         0.00%       92.818s      71.952ms           0 b           0 b     487.40 Gb     487.40 Gb          1290  
                                          model_forward         0.00%       4.011ms        16.77%       60.162s        6.016s       0.000us         0.00%       67.094s        6.709s     163.45 Kb      -1.44 Mb       9.41 Gb      -2.20 Gb            10  
                CheckpointFunctionEndWithFlashAttention         0.72%        2.593s        15.90%       57.034s     178.231ms        5.831s         1.03%       65.063s     203.321ms       1.55 Mb       1.55 Mb      10.06 Gb     -15.16 Gb           320  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 358.811s
Self CUDA time total: 563.851s

-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
autograd::engine::evaluate_function: CheckpointFunct...         0.00%      11.438ms        41.17%      147.933s     462.291ms       0.000us         0.00%      202.351s     632.348ms           0 b           0 b      29.42 Gb     -14.77 Gb           320  
        CheckpointFunctionEndWithFlashAttentionBackward         0.29%        1.034s        41.17%      147.922s     462.256ms       16.958s         3.03%      202.351s     632.348ms           0 b     -10.00 Kb      44.18 Gb     -91.47 Gb           320  
                                     record_param_comms         0.96%        3.465s         1.05%        3.789s     295.072us      181.279s        32.39%      189.037s      14.723ms           0 b           0 b           0 b           0 b         12840  
                       FullyShardedDataParallel.forward         0.23%     829.345ms        30.32%      108.935s      84.446ms       0.000us         0.00%      176.721s     136.993ms       1.60 Mb           8 b     151.24 Gb    -348.13 Gb          1290  
                                 c10d::_allgather_base_         0.01%      36.591ms         0.98%        3.513s       1.820ms       0.000us         0.00%      137.938s      71.470ms           0 b           0 b           0 b           0 b          1930  
ncclDevKernel_AllGather_RING_LL(ncclDevComm*, unsign...         0.00%       0.000us         0.00%       0.000us       0.000us      134.261s        23.99%      134.261s      69.565ms           0 b           0 b           0 b           0 b          1930  
                                  nccl:_all_gather_base         0.00%       0.000us         0.00%       0.000us       0.000us      134.261s        23.99%      134.261s      69.565ms           0 b           0 b           0 b           0 b          1930  
                  FullyShardedDataParallel._pre_forward         0.31%        1.117s        13.47%       48.389s      37.510ms       0.000us         0.00%       91.203s      70.700ms           0 b           0 b     487.40 Gb     487.40 Gb          1290  
                                          model_forward         0.00%       3.909ms        16.88%       60.643s        6.064s       0.000us         0.00%       65.765s        6.576s     163.45 Kb      -1.44 Mb       9.41 Gb      -2.20 Gb            10  
                CheckpointFunctionEndWithFlashAttention         0.97%        3.499s        15.88%       57.041s     178.253ms        6.635s         1.19%       63.915s     199.734ms       1.55 Mb       1.55 Mb      10.06 Gb     -15.14 Gb           320  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 359.286s
Self CUDA time total: 559.662s

-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
autograd::engine::evaluate_function: CheckpointFunct...         0.00%      12.320ms        41.21%      147.932s     462.288ms       0.000us         0.00%      204.099s     637.809ms           0 b           0 b      29.42 Gb     -14.77 Gb           320  
        CheckpointFunctionEndWithFlashAttentionBackward         0.29%        1.047s        41.21%      147.919s     462.248ms       16.858s         2.95%      204.043s     637.635ms           0 b     -10.00 Kb      44.18 Gb     -91.36 Gb           320  
                                     record_param_comms         0.89%        3.202s         0.98%        3.509s     227.859us      181.607s        31.75%      190.700s      12.383ms           0 b           0 b           0 b           0 b         15400  
                       FullyShardedDataParallel.forward         0.23%     835.450ms        30.42%      109.176s      84.632ms       0.000us         0.00%      187.921s     145.675ms       1.60 Mb           0 b     151.24 Gb    -347.06 Gb          1290  
                                 c10d::_allgather_base_         0.01%      36.039ms         0.89%        3.190s       1.653ms       0.000us         0.00%      137.886s      71.444ms           0 b           0 b           0 b           0 b          1930  
ncclDevKernel_AllGather_RING_LL(ncclDevComm*, unsign...         0.00%       0.000us         0.00%       0.000us       0.000us      134.600s        23.53%      134.600s      69.741ms           0 b           0 b           0 b           0 b          1930  
                                  nccl:_all_gather_base         0.00%       0.000us         0.00%       0.000us       0.000us      134.600s        23.53%      134.600s      69.741ms           0 b           0 b           0 b           0 b          1930  
                  FullyShardedDataParallel._pre_forward         0.31%        1.120s        13.42%       48.159s      37.332ms       0.000us         0.00%       91.814s      71.174ms           0 b           0 b     487.40 Gb     487.40 Gb          1290  
                                          model_forward         0.00%       4.067ms        16.81%       60.326s        6.033s       0.000us         0.00%       73.551s        7.355s     163.45 Kb      -1.44 Mb       9.41 Gb      -2.20 Gb            10  
                CheckpointFunctionEndWithFlashAttention         0.92%        3.291s        15.89%       57.050s     178.282ms        9.878s         1.73%       71.554s     223.605ms       1.55 Mb       1.55 Mb      10.06 Gb     -15.16 Gb           320  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 358.948s
Self CUDA time total: 571.938s

-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
                                                   Name    Self CPU %      Self CPU   CPU total %     CPU total  CPU time avg     Self CUDA   Self CUDA %    CUDA total  CUDA time avg       CPU Mem  Self CPU Mem      CUDA Mem  Self CUDA Mem    # of Calls  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
autograd::engine::evaluate_function: CheckpointFunct...         0.00%      11.681ms        41.52%      147.934s     462.294ms       0.000us         0.00%      200.091s     625.284ms           0 b           0 b      29.42 Gb     -14.77 Gb           320  
        CheckpointFunctionEndWithFlashAttentionBackward         0.30%        1.066s        41.52%      147.922s     462.258ms       16.046s         2.83%      200.091s     625.284ms           0 b     -10.00 Kb      44.18 Gb     -81.22 Gb           320  
                                     record_param_comms         0.15%     519.634ms         0.24%     856.768ms      55.634us      183.253s        32.28%      191.051s      12.406ms           0 b           0 b           0 b           0 b         15400  
                       FullyShardedDataParallel.forward         0.24%     839.577ms        29.93%      106.648s      82.673ms       0.000us         0.00%      190.750s     147.868ms       1.60 Mb           0 b     151.24 Gb    -346.70 Gb          1290  
                                 c10d::_allgather_base_         0.01%      36.801ms         0.15%     535.262ms     277.338us       0.000us         0.00%      139.203s      72.126ms           0 b           0 b           0 b           0 b          1930  
ncclDevKernel_AllGather_RING_LL(ncclDevComm*, unsign...         0.00%       0.000us         0.00%       0.000us       0.000us      136.224s        24.00%      136.224s      70.583ms           0 b           0 b           0 b           0 b          1930  
                                  nccl:_all_gather_base         0.00%       0.000us         0.00%       0.000us       0.000us      136.224s        24.00%      136.224s      70.583ms           0 b           0 b           0 b           0 b          1930  
                  FullyShardedDataParallel._pre_forward         0.31%        1.122s        12.73%       45.368s      35.169ms       0.000us         0.00%       92.666s      71.834ms           0 b           0 b     487.40 Gb     487.03 Gb          1290  
                                          model_forward         0.00%       3.938ms        16.18%       57.651s        5.765s       0.000us         0.00%       74.714s        7.471s     163.45 Kb      -1.44 Mb       9.41 Gb      -2.20 Gb            10  
                CheckpointFunctionEndWithFlashAttention         0.77%        2.755s        16.01%       57.035s     178.235ms        8.731s         1.54%       72.740s     227.311ms       1.55 Mb       1.55 Mb      10.06 Gb     -20.31 Gb           320  
-------------------------------------------------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  ------------  
Self CPU time total: 356.308s
Self CUDA time total: 567.651s

{'Latency (seconds)': 3163.6105420000013, 'Bandwidth (GiB per second)': 1.7199918181013076}
{'Latency (seconds)': 3154.7610799999998, 'Bandwidth (GiB per second)': 1.7306358958372412}
{'Latency (seconds)': 3210.739724000002, 'Bandwidth (GiB per second)': 1.688051310104463}
{'Latency (seconds)': 3188.9786680000034, 'Bandwidth (GiB per second)': 1.6976473924341446}
